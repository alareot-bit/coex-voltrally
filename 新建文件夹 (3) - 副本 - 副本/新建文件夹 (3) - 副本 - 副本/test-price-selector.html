<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Selector Test</title>
    <style>
        body {
            background: #0b0d10;
            color: white;
            padding: 20px;
            font-family: system-ui;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #242832;
            border-radius: 8px;
        }
        .pass {
            border-left: 4px solid #4ade80;
        }
        .fail {
            border-left: 4px solid #ff5c5c;
        }
    </style>
</head>
<body>
    <h1>Price Selector Functionality Test</h1>
    <div id="test-results"></div>

    <script>
        const results = document.getElementById('test-results');

        function addResult(test, passed, details = '') {
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${passed ? '✓' : '✗'} ${test}</strong>
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            results.appendChild(div);
        }

        // Test 1: Check localStorage structure
        const prefs = localStorage.getItem('vrPricePreferences');
        if (prefs) {
            try {
                const data = JSON.parse(prefs);
                addResult('localStorage preferences exist', true, `Found: ${JSON.stringify(data)}`);
            } catch (e) {
                addResult('localStorage preferences exist', false, 'Invalid JSON');
            }
        } else {
            addResult('localStorage preferences exist', false, 'Not found - will be created on first interaction');
        }

        // Test 2: Check if price selector elements exist
        setTimeout(() => {
            // Open main page in iframe to test
            const iframe = document.createElement('iframe');
            iframe.src = 'http://localhost:8080';
            iframe.style.width = '100%';
            iframe.style.height = '500px';
            iframe.style.marginTop = '20px';
            iframe.style.border = '1px solid #444';
            document.body.appendChild(iframe);

            iframe.onload = () => {
                const iframeDoc = iframe.contentDocument;

                // Test price options
                const priceOptions = iframeDoc.querySelectorAll('.price-option');
                addResult('Price options found', priceOptions.length > 0, `Found ${priceOptions.length} price options`);

                // Test clickability
                if (priceOptions.length > 0) {
                    const firstOption = priceOptions[0];
                    const hasPointerCursor = iframe.contentWindow.getComputedStyle(firstOption).cursor === 'pointer';
                    addResult('Price options are clickable', hasPointerCursor, 'Cursor style is pointer');
                }

                // Test PriceSelector initialization
                const priceSelector = iframe.contentWindow.VoltRallyPriceSelector;
                addResult('PriceSelector initialized', priceSelector !== undefined, priceSelector ? 'Global instance found' : 'Not found');

                // Summary
                const testCount = results.querySelectorAll('.test-result').length;
                const passCount = results.querySelectorAll('.test-result.pass').length;
                const summary = document.createElement('div');
                summary.style.marginTop = '20px';
                summary.style.fontSize = '18px';
                summary.innerHTML = `<strong>Test Summary: ${passCount}/${testCount} tests passed</strong>`;
                results.appendChild(summary);
            };
        }, 100);
    </script>
</body>
</html>